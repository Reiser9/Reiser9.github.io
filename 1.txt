&НаКлиенте
Процедура ПолучитьИнформациюОбОрганизации(Команда)
	ПолучитьИнформациюОбОрганизацииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПолучитьИнформациюОбОрганизацииНаСервере()
	Если Объект.ИНН = "" Тогда
		Сообщить("введите ИНН");
		Возврат;
	КонецЕсли;
	
	HTTPЗапрос = Новый HTTPЗапрос("/" + Объект.ИНН + ".json");
	
	ЗащищенноеСоединение = Новый ЗащищенноеСоединениеOpenSSL;
	
	HTTPСоединение = Новый HTTPСоединение("egrul.itsoft.ru", 443, , ,  ,  , ЗащищенноеСоединение);
	
	HTTPОтвет = HTTPСоединение.Получить(HTTPЗапрос);
	
	ЧтениеJSON = Новый ЧтениеJSON();
	ЧтениеJSON.ОткрытьПоток(HTTPОтвет.ПолучитьТелоКакПоток());
	
	Таблица = Объект.Информация;
	Таблица.Очистить();
	
	НаименованиеНеизвестно = Истина;
	ОГРННеизвестен = Истина;
	ДатаРегистрацииНеизвестна = Истина;
	РуководительНеизвестен = Истина;
	
	Пока ЧтениеJSON.Прочитать() Цикл
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства Тогда
			
			Если ОГРННеизвестен 
				и ЧтениеJSON.ТекущееЗначение = "ОГРН" Тогда
				ДобавитьЗаписьВТЧ(Таблица, ЧтениеJSON, "ОГРН");
				ОГРННеизвестен = Ложь;	
			КонецЕсли;
			
			Если НаименованиеНеизвестно 
				и ЧтениеJSON.ТекущееЗначение = "НаимЮЛПолн" Тогда
				ДобавитьЗаписьВТЧ(Таблица, ЧтениеJSON, "Наименование организации");
				НаименованиеНеизвестно = Ложь;
			КонецЕсли;
			
			Если ДатаРегистрацииНеизвестна
				и ЧтениеJSON.ТекущееЗначение = "ДатаРег" Тогда
				ДобавитьЗаписьВТЧ(Таблица, ЧтениеJSON, "Дата регистрации");
				ДатаРегистрацииНеизвестна = Ложь;			
			КонецЕсли;
			
			Если РуководительНеизвестен
				и ЧтениеJSON.ТекущееЗначение = "Фамилия" Тогда
				ДобавитьРуководителяВТЧ(Таблица, ЧтениеJSON);
				РуководительНеизвестен = Ложь;
				
				// т.к. получается самым последним
				Возврат;
			КонецЕсли;
			
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры 

&НаСервере
Процедура ДобавитьЗаписьВТЧ(Таблица, ЧтениеJSON, Ключ)
	ЧтениеJSON.Прочитать();
	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Ключ = Ключ;
	НоваяСтрока.Значение = ЧтениеJSON.ТекущееЗначение;
КонецПроцедуры

&НаСервере
Процедура ДобавитьРуководителяВТЧ(Таблица, ЧтениеJSON)
	ЧтениеJSON.Прочитать();
	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Ключ = "Руководитель";
	НоваяСтрока.Значение = НоваяСтрока.Значение + ЧтениеJSON.ТекущееЗначение + " ";
	ЧтениеJSON.Прочитать();
	ЧтениеJSON.Прочитать();
	НоваяСтрока.Значение = НоваяСтрока.Значение + ЧтениеJSON.ТекущееЗначение + " ";
	ЧтениеJSON.Прочитать();
	ЧтениеJSON.Прочитать();
	НоваяСтрока.Значение = НоваяСтрока.Значение + ЧтениеJSON.ТекущееЗначение;
КонецПроцедуры