&НаКлиенте
Процедура ПолучитьИнформациюОбОрганизации(Команда)
	Результат = ПолучитьИнформациюОбОрганизацииНаСервере();
	
	Для Каждого Элемент Из Результат Цикл 
		Сообщить(Элемент.Ключ + ": " + Элемент.Значение);	
	КонецЦикла;
КонецПроцедуры

&НаСервере
Функция ПолучитьИнформациюОбОрганизацииНаСервере()
	Если Объект.ИНН = "" Тогда
		Сообщить("Введите ИНН");
		Возврат Неопределено;
	КонецЕсли;
	
	Результат = Новый Массив;
	
	HTTPЗапрос = Новый HTTPЗапрос("/" + Объект.ИНН + ".json");
	
	ЗащищенноеСоединение = Новый ЗащищенноеСоединениеOpenSSL;
	
	HTTPСоединение = Новый HTTPСоединение("egrul.itsoft.ru", 443, , ,  ,  , ЗащищенноеСоединение);
	
	HTTPОтвет = HTTPСоединение.Получить(HTTPЗапрос);
	
	ЧтениеJSON = Новый ЧтениеJSON();
	ЧтениеJSON.ОткрытьПоток(HTTPОтвет.ПолучитьТелоКакПоток());
	
	Наименование = Истина;
	ОГРН = Истина;
	КПП = Истина;
	КодОПФ = Истина;
	ДатаРегистрации = Истина;
	
	Пока ЧтениеJSON.Прочитать() Цикл
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства И ДатаРегистрации
			И ЧтениеJSON.ТекущееЗначение = "ДатаРег" Тогда
			ЗаписатьЗначение(Результат, ЧтениеJSON, "Дата регистрации");
			ДатаРегистрации = Ложь;			
		КонецЕсли;
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства И ОГРН 
			И ЧтениеJSON.ТекущееЗначение = "ОГРН" Тогда
			ЗаписатьЗначение(Результат, ЧтениеJSON, "ОГРН");
			ОГРН = Ложь;	
		КонецЕсли;
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства И КПП 
			И ЧтениеJSON.ТекущееЗначение = "КПП" Тогда
			ЗаписатьЗначение(Результат, ЧтениеJSON, "КПП");
			КПП = Ложь;	
		КонецЕсли;
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства И Наименование И ЧтениеJSON.ТекущееЗначение = "НаимЮЛПолн" Тогда
			ЗаписатьЗначение(Результат, ЧтениеJSON, "Полное наименование организации");
			Наименование = Ложь;
		КонецЕсли;
		
		Если ЧтениеJSON.ТипТекущегоЗначения = ТипЗначенияJSON.ИмяСвойства И КодОПФ И ЧтениеJSON.ТекущееЗначение = "КодОПФ" Тогда
			ЗаписатьЗначение(Результат, ЧтениеJSON, "КодОПФ");
			КодОПФ = Ложь;
		КонецЕсли;		
	КонецЦикла;
	
	Возврат Результат;
КонецФункции 

&НаСервере
Процедура ЗаписатьЗначение(Результат, ОбъектЧтения, Ключ)
	
	СтруктураДанных = Новый Структура;
	ОбъектЧтения.Прочитать();
	
	СтруктураДанных.Вставить("Ключ", Ключ);
	СтруктураДанных.Вставить("Значение", ОбъектЧтения.ТекущееЗначение);
	
	Результат.Добавить(СтруктураДанных);
	
КонецПроцедуры